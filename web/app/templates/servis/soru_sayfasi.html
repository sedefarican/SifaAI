{% extends 'base.html' %}
{% block title %}Sorular{% endblock %}

{% block content %}
<h2 class="mb-4 text-center" style="color:#0ABAB5;">ðŸ’¬ SaÄŸlÄ±k SorularÄ±</h2>
<div class="d-flex" style="height:80vh; gap:20px;">

    <!-- sol menÃ¼ (geÃ§miÅŸ sorular kÄ±smÄ±) -->
    <div style="flex:0 0 25%; background-color:#D7F2EC; border-radius:10px; padding:15px; overflow-y:auto;">
        <h5 style="color:#0ABAB5;">Soru GeÃ§miÅŸiniz</h5>
        <ul class="list-unstyled question-list">
            {% for q in questions %}
                <li class="mb-2">
                    <a href="?q={{ q.question_id }}" class="text-decoration-none" style="color:#1B2A41;">
                        {{ q.question_text|truncatewords:4 }}
                    </a>
                </li>
            {% empty %}
                <li class="text-muted">HenÃ¼z soru sormadÄ±nÄ±z! </li>
            {% endfor %}
        </ul>
        <hr>
        <a href="{% url 'soru_sayfasi' %}" class="btn btn-sm btn-outline-primary w-100">+ Yeni Soru </a>
    </div>

    <!-- sohbet kÄ±smÄ± -->
    <div class="flex-grow-1" style="background-color:#F2FAF8; border-radius:10px; padding:20px; display:flex; flex-direction:column;">

        {% if active_question %}
        <div id="chat-box" style="flex-grow:1; overflow-y:auto; padding-right:10px;">
            {% for msg in messages %}
                <!-- kullanÄ±cÄ± sorusu (saÄŸ) -->
                <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
                    <div style="background-color:#D7F2EC; padding:10px 15px; border-radius:10px; max-width:50%; text-align:right;">
                        {{ msg.question_text }}
                    </div>
                </div>

                <!-- ai cevabÄ± (sol) -->
                {% if msg.answer_paragraphs %}
                <div style="display:flex; justify-content:flex-start; margin-bottom:20px;">
                    <div style="background-color:#F0F0F0; padding:12px 16px; border-radius:10px; max-width:70%; line-height:1.6; text-align:left;">
                        {% for p in msg.answer_paragraphs %}
                            <p style="margin-bottom:8px;">{{ p }}</p>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>

        <form method="post" style="display:flex; gap:10px; margin-top:10px;">
            {% csrf_token %}
            <input type="hidden" name="parent_id" value="{{ active_question.question_id }}">
            <textarea name="soru" class="form-control" rows="2" placeholder="Yeni soru yazÄ±n..."></textarea>
            <button type="submit" class="btn btn-outline-primary">GÃ¶nder</button>
        </form>
        {% else %}
            <form method="post" class="w-100">
                {% csrf_token %}
                <div class="mb-3">
                    <textarea name="soru" class="form-control" rows="4" placeholder="Sorunuzu buraya yazÄ±n..."></textarea>
                </div>
                <button type="submit" class="btn btn-outline-primary">GÃ¶nder</button>
            </form>
        {% endif %}
    </div>
</div>

<script>
    const chatBox = document.getElementById('chat-box');
    if(chatBox){ chatBox.scrollTop = chatBox.scrollHeight; }
</script>
<style>
.question-list li:hover {
    background-color: #F2FAF8;
    border-radius: 6px;
    cursor: pointer;
}
.question-list li a {
    display: block; /* TÃ¼m satÄ±rÄ± tÄ±klanabilir yapar */
    padding: 4px 6px;
    color: #1B2A41;
    text-decoration: none;
}
</style>
{% endblock %}
